L.Toolbar = L.Class.extend({
	
	statics: {
		baseClass: 'leaflet-toolbar'
	},

	includes: [L.Mixin.Events],

	options: {
		className: '',
		filter: function() { return true; },
		parameters: function() { return arguments; }
	},

	initialize: function(options) {
		L.setOptions(this, options);
	},

	addTo: function(map) {
		this._arguments = [].slice.call(arguments);

		map.addLayer(this);
	},

	/* TODO: Each toolbar icon should have a property pointing back to the toolbar (mostly for nested toolbars) */
	onAdd: function() {
		var className = this.constructor.baseClass + ' ' + this.options.className,
			toolbarContainer = L.DomUtil.create('ul', className, this.getContainer()),
			i, l;

		this._actions = this.actions.apply(undefined, this._arguments);
		l = this._actions.length;

		for (i = 0; i < l; i++) {
			this.addIcon(this._actions[i], toolbarContainer);
		}
	},

	/* This would be unecessary if every handler inherited from L.ToolbarAction. */
	addIcon: function(action, container) {
		var icon = action.options.toolbarIcon || new L.ToolbarIcon();
		icon.onAdd(container, action);
	},

	actions: function() {
		return [];
	}
});

L.toolbar = function(actions) {
	return new L.Toolbar(actions);
};